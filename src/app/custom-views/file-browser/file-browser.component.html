<div class="view-container">
  <!-- Navigation Header -->
  <app-navigation-header [title]="title" />

  <!-- Main Content -->
  <main class="view-content">
    <!-- Breadcrumb Navigation -->
  <div class="breadcrumb-bar">
    <button class="btn-icon" (click)="navigateUp()" [disabled]="pathParts().length === 0" title="Up">
      ‚¨ÜÔ∏è
    </button>

    <div class="breadcrumb">
      @if (pathParts().length === 0) {
        <span class="breadcrumb-current">Root</span>
      } @else {
        <button class="breadcrumb-link" (click)="navigateToPathPart(-1)">
          Root
        </button>
        @for (part of pathParts(); track $index; let isLast = $last) {
          <span class="breadcrumb-separator">/</span>
          @if (isLast) {
            <span class="breadcrumb-current">{{ part }}</span>
          } @else {
            <button class="breadcrumb-link" (click)="navigateToPathPart($index)">
              {{ part }}
            </button>
          }
        }
      }
    </div>

    <button class="btn-icon" (click)="refresh()" title="Refresh">
      üîÑ
    </button>
  </div>

  <!-- Error Message -->
  @if (errorMessage()) {
    <div class="error-banner">
      <span class="error-icon">‚ö†Ô∏è</span>
      <span>{{ errorMessage() }}</span>
    </div>
  }

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    </div>
  }

  <!-- File Viewer -->
  @if (fileContent() !== null && !isLoading()) {
    <div class="file-viewer">
      <div class="file-viewer-header">
        <div class="file-viewer-title">
          <span class="file-icon">{{ getEntryIcon({ name: viewingFile() || '', type: 'file' }) }}</span>
          <span>{{ viewingFile() }}</span>
        </div>
        <button class="btn-close" (click)="closeFileView()" title="Close">
          ‚úï
        </button>
      </div>

      <div class="file-viewer-content">
        @if (isTextContent(fileContentType())) {
          <!-- Text Content -->
          <pre class="text-content">{{ fileContent() }}</pre>
        } @else if (isImageContent(fileContentType())) {
          <!-- Image Content -->
          <div class="media-container">
            <img [src]="getMediaDataUrl()" [alt]="viewingFile() || ''" class="media-image" />
          </div>
        } @else if (isAudioContent(fileContentType())) {
          <!-- Audio Content -->
          <div class="media-container">
            <audio controls class="media-audio">
              <source [src]="getMediaDataUrl()" [type]="fileContentType() || ''" />
              Your browser does not support the audio element.
            </audio>
          </div>
        } @else if (isVideoContent(fileContentType())) {
          <!-- Video Content -->
          <div class="media-container">
            <video controls class="media-video">
              <source [src]="getMediaDataUrl()" [type]="fileContentType() || ''" />
              Your browser does not support the video element.
            </video>
          </div>
        } @else {
          <!-- Unsupported Content -->
          <div class="unsupported-content">
            <span class="unsupported-icon">üìÑ</span>
            <p>Preview not available for this file type</p>
            <p class="content-type">{{ fileContentType() }}</p>
          </div>
        }
      </div>
    </div>
  } @else if (!isLoading() && !errorMessage()) {
    <!-- File List -->
    <div class="file-list">
      @if (entries().length === 0) {
        <div class="empty-state">
          <span class="empty-icon">üì≠</span>
          <p>This directory is empty</p>
        </div>
      } @else {
        <div class="file-list-header">
          <div class="col-name">Name</div>
          <div class="col-type">Type</div>
          <div class="col-size">Size</div>
        </div>

        @for (entry of entries(); track entry.name) {
          <div
            class="file-entry"
            [class.directory]="entry.type === 'directory'"
            (dblclick)="onEntryDoubleClick(entry)"
            (click)="entry.type === 'directory' ? openDirectory(entry) : null"
          >
            <div class="col-name">
              <span class="entry-icon">{{ getEntryIcon(entry) }}</span>
              <span class="entry-name">{{ entry.name }}</span>
            </div>
            <div class="col-type">
              {{ entry.type === 'directory' ? 'Folder' : 'File' }}
            </div>
            <div class="col-size">
              {{ formatFileSize(entry.size) }}
            </div>
          </div>
        }
      }
    </div>
  }
  </main>
</div>
