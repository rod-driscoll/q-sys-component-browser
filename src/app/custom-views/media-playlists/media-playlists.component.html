<div class="view-container">
  <app-navigation-header [title]="title" />

  <main class="view-content">
    <!-- Audio Player Controls -->
    <div class="audio-player">
      <div class="audio-player-header">
        <h3>Audio Player</h3>
      </div>
      
      <div class="player-controls">
          <button class="control-btn" (mousedown)="rewindPress()" (mouseup)="rewindRelease()" (mouseleave)="rewindRelease()" title="Rewind">
            <span class="btn-icon">‚è™</span>
          </button>
          <button class="control-btn play-btn" [class.playing]="isPlaying" (click)="play()" title="Play">
            <span class="btn-icon">‚ñ∂</span>
          </button>
          <button class="control-btn" (mousedown)="fastForwardPress()" (mouseup)="fastForwardRelease()" (mouseleave)="fastForwardRelease()" title="Fast Forward">
            <span class="btn-icon">‚è©</span>
          </button>
          <button class="control-btn" [class.paused]="isPaused" (click)="pause()" title="Pause">
            <span class="btn-icon">‚è∏</span>
          </button>
          <button class="control-btn stop-btn" [class.stopped]="isStopped" (click)="stop()" title="Stop">
            <span class="btn-icon">‚èπ</span>
          </button>
          <button class="control-btn loop-btn" (click)="toggleLoop()" [class.active]="isLooping" title="Loop">
            <span class="btn-icon">üîÅ</span>
          </button>
          <button class="control-btn" (click)="toggleAutoPlay()" [class.active]="autoPlay" title="Auto Play">
            <span class="btn-text">Auto Play</span>
          </button>
          <div class="volume-indicator">{{ volume }}dB</div>
        </div>

        <div class="player-info">
          <div class="info-row">
            <label>Time</label>
            <div class="progress-bar-container">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="progressPercent"></div>
                <div class="progress-remaining" [style.width.%]="remainingPercent"></div>
              </div>
              <div class="progress-text">{{ timeDisplay }}</div>
            </div>
            <button class="mute-btn" (click)="toggleMute()" [class.active]="isMuted" title="Mute">
              <span class="btn-text">Mute</span>
            </button>
          </div>
          <div class="info-row">
            <label>Remaining</label>
            <div class="remaining-text">{{ remainingDisplay }}</div>
          </div>
          <div class="info-row">
            <label>Status</label>
            <div class="info-bar">{{ statusDisplay }}</div>
          </div>
          <div class="info-row">
            <label>Root</label>
            <select class="combo-box" [value]="rootDisplay" (change)="onRootChange($event)">
              @for (option of rootOptions; track option) {
                <option [value]="option" [selected]="option === rootDisplay">{{ option }}</option>
              }
            </select>
          </div>
          <div class="info-row">
            <label>Directory</label>
            <select class="combo-box" [value]="directoryDisplay" (change)="onDirectoryChange($event)">
              @for (option of directoryOptions; track option) {
                <option [value]="option" [selected]="option === directoryDisplay">{{ option }}</option>
              }
            </select>
          </div>
          <div class="info-row">
            <label>File</label>
            <select class="combo-box file-combo" [class.missing-file]="statusDisplay === 'Missing file'" [value]="fileDisplay" (change)="onFileChange($event)" [disabled]="isPlaylistActive">
              @for (option of fileOptions; track option) {
                <option [value]="option" [selected]="option === fileDisplay">{{ option }}</option>
              }
            </select>
          </div>
          <div class="info-row">
            <label>Playlist</label>
            <select class="combo-box" [value]="playlistDisplay" (change)="onPlaylistChange($event)">
              @for (option of playlistOptions; track option) {
                <option [value]="option" [selected]="option === playlistDisplay">{{ option }}</option>
              }
            </select>
          </div>
          <div class="playlist-controls">
            <button class="control-btn" (click)="playlistFirst()" [disabled]="!isPlaylistActive" title="First Track">
              <span class="btn-icon">‚èÆ</span>
            </button>
            <button class="control-btn" (click)="playlistPrev()" [disabled]="!isPlaylistActive" title="Previous Track">
              <span class="btn-icon">‚è™</span>
            </button>
            <button class="control-btn" (click)="playlistNext()" [disabled]="!isPlaylistActive" title="Next Track">
              <span class="btn-icon">‚è©</span>
            </button>
            <button class="control-btn" (click)="toggleShuffle()" [disabled]="!isPlaylistActive" [class.active]="isShuffleOn" title="Shuffle">
              <span class="btn-icon">üîÄ</span>
            </button>
            <button class="control-btn" (click)="toggleRepeat()" [disabled]="!isPlaylistActive" [class.active]="isRepeatOn" title="Repeat">
              <span class="btn-icon">üîÅ</span>
            </button>
          </div>
        </div>
      </div>

    <!-- Playlists Browser (Management API) -->
    <div class="toolbar">
      <div class="toolbar-left">
        <button class="btn" (click)="refresh()" [disabled]="isLoading()">
          {{ isLoading() ? 'Loading...' : 'Refresh' }}
        </button>
      </div>
      <div class="toolbar-right">
        @if (error()) {
          <span class="status error">{{ error() }}</span>
        } @else if (isLoading()) {
          <span class="status loading">Loading playlists...</span>
        }
      </div>
    </div>

    <div class="content-grid">
      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Playlists</div>
            <div class="panel-subtitle">{{ playlists().length }} total</div>
          </div>
        </div>
        <ul class="playlist-list">
          @if (isLoading()) {
            <div class="empty-state">‚è≥ Loading playlists...</div>
          } @else if (error()) {
            <div class="empty-state error-state">‚ùå {{ error() }}</div>
          } @else if (playlists().length === 0) {
            <div class="empty-state">üìÇ No playlists found</div>
          } @else {
            @for (playlist of playlists(); track playlist.id) {
              <li 
                class="playlist-item" 
                [class.active]="selectedPlaylist()?.id === playlist.id"
                (click)="selectPlaylist(playlist)">
                <div class="playlist-header-row">
                  <div class="playlist-title">üéµ {{ playlist.name || 'Untitled Playlist' }}</div>
                  @if (playlist.items && playlist.items.length > 0) {
                    <span class="playlist-badge">{{ playlist.items.length }} tracks</span>
                  }
                </div>
                @if (playlist.description) {
                  <div class="playlist-description">{{ playlist.description }}</div>
                }
                <div class="playlist-meta">
                  <span class="meta-item">ID: {{ playlist.id }}</span>
                </div>
              </li>
            }
          }
        </ul>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">Details</div>
            @if (selectedPlaylist()) {
              <div class="panel-subtitle">{{ selectedPlaylist()!.name }}</div>
            }
          </div>
        </div>
        <div class="details">
          @if (!selectedPlaylist()) {
            <div class="empty-state">üëà Select a playlist to view details</div>
          } @else {
            <div class="playlist-summary">
              <div class="summary-row">
                <span class="summary-label">ID:</span>
                <span class="summary-value">{{ selectedPlaylist()!.id }}</span>
              </div>
              @if (selectedPlaylist()!.description) {
                <div class="summary-row">
                  <span class="summary-label">Description:</span>
                  <span class="summary-value">{{ selectedPlaylist()!.description }}</span>
                </div>
              }
              <div class="summary-row">
                <span class="summary-label">Tracks:</span>
                <span class="summary-value">{{ selectedPlaylist()!.items?.length || 0 }}</span>
              </div>
            </div>
            
            <div class="section-divider">Tracks</div>
            
            <div class="items-list">
              @if (selectedPlaylist()!.items && selectedPlaylist()!.items!.length > 0) {
                @for (item of selectedPlaylist()!.items; track item.id; let idx = $index) {
                  <div class="item-row">
                    <div class="item-number">{{ idx + 1 }}</div>
                    <div class="item-content">
                      <div class="item-name">üéµ {{ item.name || 'Untitled' }}</div>
                      <div class="item-meta">
                        @if (item.type) {
                          <span class="pill">{{ item.type }}</span>
                        }
                        @if (item.duration) {
                          <span class="pill pill-muted">‚è± {{ formatDuration(item.duration) }}</span>
                        }
                        <span class="pill pill-muted">ID: {{ item.id }}</span>
                      </div>
                    </div>
                  </div>
                }
              } @else {
                <div class="empty-state">üìÇ This playlist is empty</div>
              }
            </div>
          }
        </div>
      </div>
    </div>

  </main>
</div>
