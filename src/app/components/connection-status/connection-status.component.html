<!-- Latency Indicator - shown when connected -->
@if (showLatencyIndicator()) {
  <div
    class="latency-indicator"
    [class]="'latency-' + latencyQuality()">
    <div class="latency-dot"></div>
    <span class="latency-value">{{ latency() }}ms</span>
    <span class="latency-separator">|</span>
    <span class="latency-poll">Poll: {{ pollInterval() }}ms</span>
  </div>
}

<!-- Connection Status Banner - shown when disconnected -->
@if (showBanner()) {
  <div class="connection-banner" (click)="openSettings()" title="Click to configure connection">
    <span class="status-dot disconnected"></span>
    <span class="banner-title">Disconnected</span>
  </div>
}

<!-- Settings Dialog -->
@if (showDialog()) {
  <div class="dialog-overlay" (click)="closeSettings()">
    <div class="dialog" (click)="$event.stopPropagation()">
      <div class="dialog-header">
        <h2>Q-SYS Connection Settings</h2>
        <button class="close-button" (click)="closeSettings()" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="dialog-body">
        <div class="form-group">
          <label for="qsys-ip">Q-SYS Core IP Address</label>
          <input
            type="text"
            id="qsys-ip"
            [value]="formIp()"
            (input)="updateIp($event)"
            placeholder="192.168.1.100"
            autocomplete="off" />
        </div>

        <div class="form-group">
          <label for="qsys-username">Username</label>
          <input
            type="text"
            id="qsys-username"
            [value]="formUsername()"
            (input)="updateUsername($event)"
            placeholder="admin"
            autocomplete="username" />
        </div>

        <div class="form-group">
          <label for="qsys-password">Password</label>
          <input
            type="password"
            id="qsys-password"
            [value]="formPassword()"
            (input)="updatePassword($event)"
            placeholder="password"
            autocomplete="current-password" />
        </div>

        <div class="info-box">
          <div class="info-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <path d="M12 16v-4M12 8h.01"/>
            </svg>
          </div>
          <div class="info-text">
            <strong>Current Connection:</strong><br/>
            IP: {{ connectionInfo().ip }}<br/>
            Port: {{ connectionInfo().port }}<br/>
            Secure: {{ connectionInfo().secure ? 'Yes (HTTPS/WSS)' : 'No (HTTP/WS)' }}
          </div>
        </div>
      </div>

      <div class="dialog-footer">
        <button class="cancel-button" (click)="closeSettings()">Cancel</button>
        <button class="apply-button" (click)="applySettings()">Apply & Reconnect</button>
      </div>
    </div>
  </div>
}
