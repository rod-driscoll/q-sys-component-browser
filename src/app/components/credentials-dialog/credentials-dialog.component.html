<div class="credentials-container">
  <!-- Trigger Button -->
  <button 
    class="btn-credentials" 
    [class.authenticated]="isAuthenticated()"
    (click)="openDialog()" 
    [title]="authStatus()"
  >
    üîê
  </button>

  <!-- Modal Dialog -->
  @if (isOpen) {
    <div class="modal-overlay" (click)="closeDialog()"></div>
    <div class="modal-dialog">
      <div class="dialog-header">
        <h2>Q-SYS Authentication</h2>
        <button class="btn-close" (click)="closeDialog()" title="Close">‚úï</button>
      </div>

      <div class="dialog-body">
                <!-- Authentication Status -->
                <div class="auth-status" [class.authenticated]="isAuthenticated()">
                  <span class="status-text">{{ authStatus() }}</span>
                </div>

                <!-- Login Error -->
                @if (loginError) {
                  <div class="error-message">
                    {{ loginError }}
                  </div>
                }

        <div class="form-group">
          <label for="username">Username:</label>
          <input
            id="username"
            type="text"
            [(ngModel)]="tempUsername"
            placeholder="Enter username"
            class="form-input"
                      [disabled]="isLoggingIn"
          />
        </div>

        <div class="form-group">
          <label for="password">Password:</label>
          <div class="password-input-group">
            <input
              id="password"
              [type]="showPassword ? 'text' : 'password'"
              [(ngModel)]="tempPassword"
              placeholder="Enter password"
                            [disabled]="isLoggingIn"
              class="form-input"
            />
            <button
              class="btn-toggle-password"
              (click)="togglePasswordVisibility()"
              title="Toggle password visibility"
                          [disabled]="isLoggingIn"
            >
              {{ showPassword ? 'üëÅÔ∏è' : 'üëÅÔ∏è‚Äçüó®Ô∏è' }}
            </button>
          </div>
        </div>
      </div>

      <div class="dialog-footer">
        <button 
          class="btn-secondary" 
          (click)="resetToDefaults()"
          [disabled]="isLoggingIn"
        >
          Reset to Defaults
        </button>
        <div class="button-group">
          <button 
            class="btn-secondary" 
            (click)="closeDialog()"
            [disabled]="isLoggingIn"
          >
            Cancel
          </button>
          <button 
            class="btn-primary" 
            (click)="saveCredentials()"
            [disabled]="isLoggingIn || !tempUsername.trim() || !tempPassword.trim()"
          >
            {{ isLoggingIn ? 'Logging in...' : 'Login' }}
          </button>
        </div>
      </div>
    </div>
  }
</div>
